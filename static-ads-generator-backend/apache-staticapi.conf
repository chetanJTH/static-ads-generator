<VirtualHost *:80>
    ServerName staticapi.kraftey.com
    ServerAlias www.staticapi.kraftey.com
    
    # Redirect HTTP to HTTPS
    Redirect permanent / https://staticapi.kraftey.com/
</VirtualHost>

<VirtualHost *:443>
    ServerName staticapi.kraftey.com
    ServerAlias www.staticapi.kraftey.com
    
    # SSL Configuration
    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/staticapi.kraftey.com.crt
    SSLCertificateKeyFile /etc/ssl/private/staticapi.kraftey.com.key
    SSLCertificateChainFile /etc/ssl/certs/staticapi.kraftey.com.chain.crt
    
    # Security Headers
    Header always set X-Frame-Options DENY
    Header always set X-Content-Type-Options nosniff
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # CORS Headers
    Header always set Access-Control-Allow-Origin "https://kraftey.com"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS, PATCH"
    Header always set Access-Control-Allow-Headers "Accept, Accept-Language, Content-Language, Content-Type, Authorization, X-Requested-With, Origin, Access-Control-Request-Method, Access-Control-Request-Headers, DNT, User-Agent, Referer, sec-ch-ua, sec-ch-ua-mobile, sec-ch-ua-platform"
    Header always set Access-Control-Allow-Credentials "true"
    Header always set Access-Control-Max-Age "3600"
    
    # Handle preflight requests
    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]
    
    # Proxy to FastAPI application
    ProxyPreserveHost On
    ProxyPass / http://127.0.0.1:8000/
    ProxyPassReverse / http://127.0.0.1:8000/
    
    # Proxy settings
    ProxyRequests Off
    ProxyTimeout 300
    
    # File upload size limit
    LimitRequestBody 10485760  # 10MB
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/staticapi_error.log
    CustomLog ${APACHE_LOG_DIR}/staticapi_access.log combined
    
    # Health check endpoint (no logging)
    <Location /health>
        CustomLog ${APACHE_LOG_DIR}/staticapi_access.log combined env=!dontlog
    </Location>
</VirtualHost>
